<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>添加事件</title>
		<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/bootstrap-table.min.css"/>
		<link src="../../css/layer.css" type="text/javascript" charset="utf-8"></link>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" id="deepColour" type="text/css" href="../../css/deepColor.css"/>
		<style type="text/css">
			.propertyNav{
				margin-bottom:10px;
				/* display:none; */
			}
			.propertyNav a{
				font-size:12px;
				margin:10px;
				color:#428bca;
			}
			.propertyNav a:hover{
				text-decoration: underline;
			}
			.content .emptyBox{
				width:20%;
				float:left;
				height:10px;
				transition: all 0.4s ease 0s;
			}
			.content .paramBox{
				width:60%;			
				padding:20px;
				float:left;				
			}
			.content .paramBox>div{
				background:#2e3e4e;
				padding:20px 0;
			}
			.content .actionBox,.content .equipmentBox{
				width:40%;
				background:#2e3e4e;
				max-width:600px;
			}
			.content .row{
				padding: 10px;
			}
			.content .row>div{
				padding-left:30px;
			}
			.content .row>div label{
				width: 100px;
				/* text-align: end; */
				float: left;
				height:34px;
				line-height: 34px;
				margin-right: 20px;
			}
			.content .row>div>input{
			    float: left;
			    width: 77%;
			}
			.content .row>div>select{
				float: left;
			    width: 76%;
			}
			.content .row>div textarea {
			    float: left;
			    width: 77%;
			}
			.content .equipmentWarpper{
				height:0;
				overflow:hidden;
				
				padding:0;
				transition: all 0.4s ease 0s;
			}
			.selectedEquipmentBox{
				max-height:300px!important;
				overflow-y:auto;
			}
			.selectAction,.selectEquipment {
			    font-size: 12px!important;
			    color: #1ab394;
			    padding-left: 0!important;
			    border:0!important;
			}
			.selectAction:hover,.selectEquipment:hover{
				color: #1ab394;
		    	text-decoration: underline;
		    	background: 0;
		    	border:0;
			}
			.selectedActionBox ,.selectedEquipmentBox{
			    border: 0;
			    background: 0;
			    color: #56a4ef;
			    box-shadow: 0px 0px 7px 1px #4781bb;
			    min-height: 100px;
			    padding:5px;
			    
			}
			.selectedActionBox table,.selectedEquipmentBox table{
				overflow:hidden;
			}
			.selectedActionBox tbody tr{
				cursor:move;
				user-select:none;
			    -webkit-user-select:none;
			    -ms-user-select:none;
			    -moz-user-select:none;
			}
			.selectedActionBox tbody i ,.selectedEquipmentBox tbody i {
				margin-right:5px;
				cursor:pointer;
			}
			.inputWarpper{
				padding:0;
				width:77%;
				float: left;
			}
			.actionBox,.equipmentBox{
				 box-shadow: 0px 0px 7px 1px #4781bb;
				 padding:10px;
				 height:90vh;
				 position:fixed;
				 top:20px;
				 /* right:10px; */
				 right:-52%;
				 transition:all 0.5s;
				 /* transform: scale3d(1, 1, 1); */
			}
			.listTitleBox{
				width:100%;
			 	max-width: 600px;
    			padding: 0 10px;
    			/* right:10px; */
				background:#2e3e4e;
				margin-bottom: 15px;
			    /* position: fixed; */
			    border-bottom: 1px solid #386c9a;
			}
			.actionBoxTitle{
			    display: inline-block;
			    width: 80px;
			    position: absolute;
			    left: 50%;
			   	margin-left: -40px;
    			text-align: center;
			    font-size: 16px;
			    font-weight: 600;
			    color:#b7795a;
			}
			.actionBox button,.equipmentBox button{
				background:#386c9a!important;
				width:53px;
			}
			.actionBox tbody tr,.equipmentBox tbody tr{
				cursor:move;
				user-select:none;
			    -webkit-user-select:none;
			    -ms-user-select:none;
			    -moz-user-select:none;
			}
			.actionBox-logtype{
			    background:#2e3e4e;
			    top: 58px;
				display:flex;
				justify-content: center;
				height:30px;
				padding:0 10px;
				margin-bottom:10px;
			}
			.actionBox-logtype lable{
				width:90px;
				height:30px;
				line-height:30px;
				text-algin:center;
				font-weight: 600;
				color:#56a4ef;
			}
			.actionBox-logtype .form-control{
				height:30px;
				padding:0 10px;	
				border-radius:0;			
			}
			.eqTableBox{
				height:calc(100% - 50px);
				overflow:auto;
			}
			
			.acTableBox{
				overflow:auto;
				/* padding-top:90px; */
				height: calc(100% - 90px);
			}
			.layui-layer-content{
				padding:10px;
			}
			.alarmBox{
				height:0;
				overflow:hidden;
				transition: all 0.4s ease 0s;
			}
			.timeBox{
				display:flex;
			}
			.timeBox span{
				display: inline-block;
    			width: 25%;
			}
			.btnBox{
				display:flex;
				justify-content:center;
			}
			.submitParam{
				background:#386c9a!important;
				margin:0 20px;
			}
			.goBack{
				border:1px solid #386c9a;
				color:#fff;
				margin:0 20px;
			}
			.goBack:hover{
				color:#fff;
			}
		</style>
	</head>
	<body>
		<div id="box">
			<div class="top_title">
				新增事件
			</div>
			<div class="propertyNav">
				<a href="eventList.html">事件列表</a>><!-- <a class="secondA" href="javascript:void(0);">新增事件</a> --> <a class="secondA" href="addEvent.html">新增事件</a><a href="eventList.html">返回上一级</a>
			</div>
			<!-- javascript:void(0) -->
			<div class="content">
				<div class="emptyBox"></div>
				<div class="paramBox">
					<div>
						<div class="row">
							<div class="col-sm-12">
								<label>事件名称  ：</label>
		    					<input type="text" class="form-control eventName"  placeholder="事件名称">
							</div>
						</div>
						<div class="row">
							<div class-sm-12>
								<label>事件类型  ：</label>
		    					<select class="form-control eventType">
		    						<option value="0">系统事件</option>
		    						<option value="1">资产事件</option>
		    					</select>
							</div>
						</div>
						<div class="row equipmentWarpper">
							<div class="col-sm-12">
								<label>绑定资产  ：</label>
		    					<div class="inputWarpper">
		    						<div style="margin-bottom:10px;"><a href="javascript:void(0);" class="selectEquipment">选择资产</a></div>
		    						<div class="selectedEquipmentBox">
		    							<table data-toggle="table" data-classes="table table-hover ">
											<thead>
												<tr>
													<th>资产名称</th>
													<th>主机名</th>
													<th>资产类型</th>
													<th>日志类型</th>
													<th>IP地址</th>
													<th>操作</th>
												</tr>
											</thead>
											<tbody id="selectedEquipmentBox">
												
											</tbody>
										</table>
		    							
		    						</div>
		    						
		    					</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<label>动作名称  ：</label>
		    					<div class="inputWarpper">
		    						<div style="margin-bottom:10px;"><a href="javascript:void(0);" class="selectAction">选择动作</a><span class="selectActionDes">(可拖拽排序)</span></div>
		    						<div class="selectedActionBox">
		    							<table data-toggle="table" data-classes="table table-hover ">
											<thead>
												<tr>
													<th>动作名称</th>
													<th>创建人</th>
													<!-- <th>资产名称</th> -->
													<th>日志类型</th>
													<th>关键字</th>
													<th>次数</th>
													<th>操作</th>
												</tr>
											</thead>
											<tbody id="selectedActionBox">
												
											</tbody>
										</table>
		    							
		    						</div>
		    						
		    					</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<label>是否启用  ：</label>
								<div class="inputWarpper" style="height:34px;line-height: 34px;">
									<input type="radio" name="isUsed" value="1" checked class="yes">是
		    						<input type="radio" name="isUsed" value="0" class="no">否
								</div> 				
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<label>是否告警  ：</label>
		    					<div class="inputWarpper" style="height:34px;line-height: 34px;">
									<input type="radio" name="isAlarm" value="1"  class="yes">是
		    						<input type="radio" name="isAlarm" value="0" checked class="no">否
								</div> 	
							</div>
						</div>
						<div class="alarmBox">
							<div class="row">
								<div class="col-sm-12">
									<label>策略名称 ：</label>
			    					<input type="text" class="form-control alarmName"  placeholder="策略名称">
								</div>
							</div>
							<div class="row">
								<div class="col-sm-12">
									<label>选择时间 ：</label>
									<div class="inputWarpper timeBox">
										<span>
											<label>月</label>
											<select class="form-control safe_month">
												<option value="00"></option>
											</select>
										</span>
										<span>
											<label>日</label>
											<select class="form-control safe_day">
												<option value="00"></option>
											</select>
										</span>
										<span>
											<label>时</label>
											<select class="form-control safe_hour">
												<option value="00"></option>
											</select>
										</span>
										<span>
											<label>分</label>
											<select class="form-control safe_min">
												<option value="00"></option>
											</select>
										</span>
									</div>
								</div>	
							</div>
						</div>
						
						<div class="row">
							<div class="col-sm-12">
								<label>事件描述  ：</label>
		    					<textarea class="form-control eventDes"></textarea>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 btnBox">
								<button class="btn btn-info submitParam">提交</button>
								<button class="btn goBack">返回</button>
							</div>
						</div>
					</div>	
				</div>
				<div class="actionBox">
					<div class="listTitleBox"><button class="btn btn-info  closeActionBox">关闭</button><span class="actionBoxTitle">动作列表</span> <!-- <span style="float:right;color:#b7795a;">提示：拖入左侧黄框中</span> --></div>
					<div class="actionBox-logtype">
						<lable>日志类型：</lable>
						<select class="form-control selectLogType">
	   						<option value="syslog">syslog</option>
 							<option value="winlog">winlog</option>
 							<option value="snmp">snmp</option>
 							<option value="log4j">log4j</option>
 							<option value="mysql">mysql</option>
 							<option value="packetfilteringfirewall_log">packetfilteringfirewall_log</option>
	   					</select>						
					</div>
					<div class="acTableBox">
						<table data-toggle="table" data-classes="table table-hover">
							<thead>
								<tr>
									<th>动作名称</th>
									<th>创建人</th>
									<!-- <th>资产名称</th> -->
									<th>日志类型</th>
									<th>关键字</th>
								</tr>
							</thead>
							<tbody id="acl">
								<!-- <tr>
									<td>登录</td>
									<td>李洪连</td>
									<td>jr</td>
									<td>winlog</td> 
								</tr> -->
							</tbody>
						</table>
					</div>
				</div>
				<div class="equipmentBox">
					<div class="listTitleBox"><button class="btn btn-info  closeEquipmentBox">关闭</button><span class="actionBoxTitle">资产列表</span> <!-- <span style="float:right;color:#b7795a;">提示：拖入左侧黄框中</span> --></div>
					<div class="eqTableBox">
						<table data-toggle="table" data-classes="table table-hover">
							<thead>
								<tr>
									<th>资产名称</th>
									<th>主机名</th>
									<th>资产类型</th>
									<th>日志类型</th>
									<th>IP地址</th>
								</tr>
							</thead>
							<tbody id="eql">
								<tr>
									<td>设备1</td>
									<td>jxs</td>
									<td>主机-windows</td>
									<td>winlog</td> 
									<td>123.123.2.36</td> 
								</tr>
							</tbody>
						</table>
					</div>
					
				</div>
			</div>
		</div>
		
		
		
		<script src="../../js/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/bootstrap-table/js/bootstrap-table.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/bootstrap-table/js/bootstrap-table-zh-CN.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/Sortable.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/ajax.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			var url = '../../event/insert.do';//添加事件链接
			//获取动作列表数据
			function getActionList(obj){
				$.ajax({
					url:'../../action/selectAllByType.do',
					data:obj,
					type:"post",  //提交方式  
			        dataType:"json", //数据类型  
					success:function(data){
						//填充数据
						var html = '';
						for(var i in data[0]){
							var obj = data[0][i];
							//拼接
							html += '<tr data-id="'+obj.id+'" class="actionTr">'
				                 +		'<td class="action_name">'+obj.name+'</td>'
				                 +		'<td class="action_user">'+obj.userName+'</td>'
				                 /* +		'<td class="action_eqName">'+obj.equipmentName+'</td>' */
				                 +		'<td class="action_logType">'+obj.type+'</td>'
		 		                 +		'<td class="action_keyWords">'+obj.feature+'</td>'
		 		                /*      +		'<td class="action_eqUser">'+obj.equipmentUserName+'</td>' */
				                 +	'</tr>'
						}
				        $(".actionBox tbody").html(html);
				        
				      //添加鼠标拖拽排序问题		 
						 var list = document.getElementById("acl");
						 var sort1 = new Sortable(list,{
							 group:{
								 name:"actionBox",
								 pull:"clone",
								 put:false
							 },
							 forceFallback:true,
							 sort:false,
							 animation: 150
						 })						 
					}
				})
			}
			//初始化 日志类型参数
			var logTypeObj = {};
			logTypeObj.type = 'syslog';
			//获取动作列表
			getActionList(logTypeObj);
			//日志框改变事件
			$(".selectLogType").change(function(){
				//改变参数 获取动作列表
				logTypeObj.type = $(this).val();
				getActionList(logTypeObj)
			})
			
			//获取设备列表
			$.ajax({
				url:'../../equipment/selectAll.do',
				data:'',
				type:"post",  //提交方式  
		        dataType:"json", //数据类型  
				success:function(data){
					//填充数据
					var html = '';
					for(var i in data[0]){
						var obj = data[0][i];
						//拼接
						html += '<tr data-id="'+obj.id+'" class="equipmentTr">'
			                 +		'<td class="equipment_name">'+obj.name+'</td>'
			                 +		'<td class="equipment_hostname">'+obj.hostName+'</td>'
			                 +		'<td class="equipment_type">'+obj.type+'</td>'
	 		                 +		'<td class="equipment_logType">'+obj.logType+'</td>'
	 		                 +		'<td class="equipment_ip">'+obj.ip+'</td>'
			                 +	'</tr>'
					}
			        $(".equipmentBox tbody").html(html);
			        
			      //添加鼠标拖拽排序问题		 
					 var eqlist = document.getElementById("eql");
					 var eqsort = new Sortable(eqlist,{
						 group:{
							 name:"equipmentBox",
							 pull:"clone",
							 put:false
						 },
						 forceFallback:true,
						 sort:false,
						 animation: 150
					 })						 
				}
			})
				
			 //资产框	 
			 var seqBox = document.getElementById("selectedEquipmentBox");
			 var seqsort = new Sortable(seqBox,{
				 group:{
					 name:"equipmentBox",
					 pull:false
				 },
				 animation: 150,
				 sort:false,
				 forceFallback:true,
				 //列表被添加元素事件
				 onAdd:function(evt){
					 //删除空结果提示
					 $(".selectedEquipmentBox .no-records-found").remove();
					 $(evt.item).append('<td><i class="glyphicon glyphicon-remove removeEquipment" title="删除"></i></td>');		
				 	 $(".layui-layer-setwin").remove();
				 } 
			 }); 
			//事件类型改变事件
			$(".eventType").change(function(){
				//关闭动作列表
				$(".closeActionBox").click();
				//判断事件类型 1-资产 0-系统
				if($(this).val() == '1'){
					//出现绑定资产框
					$(".selectEquipment").click();
				}else if($(this).val() == '0'){
					//移除绑定资产框
					$(".equipmentWarpper").css({"height":"0","padding":"0"});
					//移除资产列表
					$(".closeEquipmentBox").click();
				}
			})
			//选择资产按钮
			$(".selectEquipment").click(function(){
				//关闭动作列表
				$(".closeActionBox").click();
				//出现绑定资产框
				$(".equipmentWarpper").css({"height":"auto","padding":"10px"});
				//右侧滑出资产列表
				$(".equipmentBox").css("right","10px");
				$(".emptyBox").css("width","0");
				$(".selectedEquipmentBox").css("border","2px solid #e4956d");
			})
			//关闭资产列表
			$(".closeEquipmentBox").click(function(){
				//移除资产列表
				$(".equipmentBox").css("right","-52%");
				$(".emptyBox").css("width","20%");
				$(".selectedEquipmentBox").css("border","0");
			})
		  	//获得eventId（修改跳转的页面）
		  	var getEventId = sessionStorage.getItem("eventId");//获取本地存储的设备值 对象
		  	sessionStorage.removeItem("eventId");//删除本地缓存
			//如果getEventIdId == null 说明不是从资产列表跳转过来的
			if(getEventId != null){
				$(".secondA").html('修改事件');
				//成功回调函数
				var sfunc = function(data){//成功
					/* if(data.success == "true"){
						layer.msg(data.message,{icon: 1});
						//显示弹窗
						layHtml('edit',eventIndex,data);
						console.log(data)
					}else if(data.success == "false"){//失败
						layer.msg(data.message,{icon: 5});
					}  */
					//填充数据
					$(".top_title").html("修改事件 -‘"+data.event.name+"’");
					$(".eventName").val(data.event.name);//事件名
					$(".eventDes").val(data.event.message);//事件描述
					$(".eventType").val(data.event.event_classify);//事件类型
					$(".eventType").attr("disabled", true);//禁用事件类型
					if(data.event.event_classify == "1"){//资产事件
						$(".selectedEquipmentBox .no-records-found").remove();
						var ehtml = '';
						//出现绑定资产框
						$(".equipmentWarpper").css({"height":"auto","padding":"10px"});
						//拼接资产列表
						for(var i in data.event.equipment){
							var obj = data.event.equipment[i];
							ehtml   = '<tr data-id="'+obj.id+'" class="equipmentTr">'
									 +	'<td class="equipment_name">'+obj.name+'</td>'
									 +	'<td class="equipment_hostName">'+obj.hostName+'</td>'
									 +	'<td class="equipment_type">'+obj.type+'</td>'
									 +	'<td class="equipment_logType">'+obj.logType+'</td>'
									 +	'<td class="equipment_ip">'+obj.ip+'</td>'
									 +	'<td><i class="glyphicon glyphicon-remove removeEquipment" title="删除"></i></td>'
									 + '</tr>'
							$("#selectedEquipmentBox").append(ehtml);
						}
					}
					if(data.event.state == 0){//状态为0-否  是否启用
						$(".yes[name='isUsed']").removeAttr("checked");
						$(".no[name='isUsed']").attr("checked","checked");
					}
					if(data.event.enabled == 0){//状态为0-否  是否告警						
						$(".alarmBox").css("height","0");
					}else{
						$(".no[name='isAlarm']").removeAttr("checked");
						$(".yes[name='isAlarm']").attr("checked","checked");
						//
						$(".alarmBox").css("height","152px");
					}
					$(".alarmName").val(data.event.safeStrategyName);//策略名
					$(".safe_month").val(data.event.month);//月
					$(".safe_day").val(data.event.day);//天
					$(".safe_hour").val(data.event.hour);//时
					$(".safe_min").val(data.event.minute);//分
					//动作列表
					//通过动作数组的长度 决定循环的次数
					for(var i = 0;i < data.action[0].length;i++){
						$(".no-records-found").remove();
						//通过遍历每一个动作对象 判断添加动作的位置
						for(var j in data.action[0]){
							//如果当前的动作对象与序列号相同则添加到页面中
							if(data.action[0][j].order == i){
								var actionLi = '';
								actionLi = '<tr data-id="'+data.action[0][j].id+'" class="actionTr">'
										 +	'<td class="action_name">'+data.action[0][j].name+'</td>'
										 +	'<td class="action_user">'+data.action[0][j].userName+'</td>'
										 +	'<td class="action_eqName">'+data.action[0][j].equipmentName+'</td>'
										 +	'<td class="action_logType">'+data.action[0][j].type+'</td>'
										 +	'<td class="action_keyWords">'+data.action[0][j].feature+'</td>'
										 +	'<td class="actionNum">'+data.action[0][j].number+'</td>'
										 +	'<td><i class="glyphicon glyphicon-edit edit" title="修改"></i><i class="glyphicon glyphicon-remove removeAction" title="删除"></i></td>'
										 + '</tr>'
								$("#selectedActionBox").append(actionLi);
							}
						}
						
					}
				}
				//失败回调函数
				var efunc = function(data){
					console.log(data)
					layer.msg('操作失败',{icon: 5});
				}
				//发送请求
				ajaxPost("../../event/selectEventAction.do ",{id:getEventId},sfunc,);
			}
			
			 //添加鼠标拖拽排序问题		 
			 var list = document.getElementById("selectedActionBox");
			 var sort2 = new Sortable(list,{
				 group:{
					 name:"actionBox",
					 pull:false
				 },
				 animation: 150,
				 forceFallback:true,
				 //列表被添加元素事件
				 onAdd:function(evt){
					 //删除空结果提示
					 $(".selectedActionBox .no-records-found").remove();
					 //定义初始次数
					 var actionNum = 1;		
					 //出现弹窗
					 layer.open({				
				 		type: 1,
				 		title:'动作次数',//标题
						area: ['250px', '170px'], //宽高
						btn: ['确定'], //按钮
						btn1:function(index){
							layer.close(index);
							actionNum = $(".layui-layer-input").val();
					    	$(evt.item).append('<td class="actionNum">'+actionNum+'</td><td><i class="glyphicon glyphicon-edit edit" title="修改"></i><i class="glyphicon glyphicon-remove removeAction" title="删除"></i></td>');								
						},
						content:'<input type="number" class="form-control layui-layer-input" style="margin-top: 10px;"  autofocus="autofocus" value="1">'
				 	})
				 	$(".layui-layer-setwin").remove();
				 } 
			 }); 
			 //修改动作次数按钮
			 $("#selectedActionBox").on("click",".edit",function(){
				 var $this = $(this);
				 var actionNum = $this.parent().siblings(".actionNum").html()
					//弹窗				 
				 	layer.open({				
				 		type: 1,
				 		title:'修改次数',//标题
						area: ['250px', '170px'], //宽高
						btn: ['确定'], //按钮
						btn1:function(index){
							layer.close(index);
							var num = $(".layui-layer-input").val();	
							$this.parent().siblings(".actionNum").html(num)
						},
						content:'<input type="number" class="form-control layui-layer-input" style="margin-top: 10px;"  autofocus="autofocus" value="'+actionNum+'">'
				 	})
			 })
			 //删除所选动作事件 - 删除所选资产事件 
			 $("#selectedActionBox,#selectedEquipmentBox").on("click",".removeAction,.removeEquipment",function(){
				var $this = $(this); 
				//询问框
				layer.confirm('确定删除？', {
				  btn: ['确定','取消'] //按钮
				}, function(index){
					layer.close(index);			
					if($this.parents('tbody').children('tr').length == 1){
						$this.parents('tbody').append('<tr class="no-records-found sortable-drag" draggable="false" style=""><td colspan="6">没有找到匹配的记录</td></tr>')
					}
					$this.parents('tr').remove();		
				}, function(){
					  layer.close();
				});
				  
			  })
			 
			//点击选择动作按钮 右边滑出动作列表
			$(".selectAction").click(function(){
				//移除事件列表
				$(".closeEquipmentBox").click();
				//滑出动作列表
				$(".actionBox").css("right","10px");
				$(".emptyBox").css("width","0");
				$(".selectedActionBox").css("border","2px solid #e4956d");
			})
			//关闭动作列表
			$(".closeActionBox").click(function(){
				$(".selectedActionBox").css("border","0");
				$(".actionBox").css("right","-52%");
				$(".emptyBox").css("width","20%");
			})
			
			//是否告警点击出现策略选项
			$("input[name='isAlarm']").click(function(){
				if($(this).val() == "1"){
					$(".alarmBox").css("height","152px");
				}else{
					$(".alarmBox").css("height","0");
				}
			})
			
			
			//添加月
		  	for(var i = 1;i <= 12;i++){
		  		$(".safe_month").append('<option value="'+i+'">'+i+'</option>');
		  	}
		  	//添加日
		  	for(var i = 1;i <= 30;i++){
		  		$(".safe_day").append('<option value="'+i+'">'+i+'</option>');
		  	}
		  	//添加时
		  	for(var i = 1;i <= 24;i++){
		  		$(".safe_hour").append('<option value="'+i+'">'+i+'</option>');
		  	}
		  	//添加分
		  	for(var i = 1;i <= 60;i++){
		  		$(".safe_min").append('<option value="'+i+'">'+i+'</option>');
		  	}
		  	
		  	//提交按钮 点击事件
		  	$(".submitParam").click(function(){
		  		//获取参数
		  		var acIds = "";//选中的动作Id
		  		//资产id
		  		var eqIds = "";
				//获得修改后的事件名
				var eventName = $(".eventName").val();
				//获得事件类型
				var eventType = $(".eventType").val();
				//是否启用状态
				var isUsedState = $("input[name='isUsed']:checked").val();
				//是否告警状态
				var isAlarmState = $("input[name='isAlarm']:checked").val();//enabled
				//获得事件描述
				var eventDes = $(".eventDes").val();
				//获得创建人
				var userId = JSON.parse(localStorage.getItem('LoginUser'))[0].id;
				//获得策略名称
				var alarmName = $(".alarmName").val();//safeStrategyName
				var month = $(".safe_month").val();
  				//日
  				var day = $(".safe_day").val();
  				//时
  				var hour = $(".safe_hour").val();
  				//分
  				var minute = $(".safe_min").val();
  				//动作 拼接
  				var actionList = $("#selectedActionBox .actionTr");
  				for(var i = 0;i < actionList.length;i++){
  					//id
  					var id = $(actionList[i]).attr("data-id");
  					//次数
  					var num = $(actionList[i]).children(".actionNum").html()
  					acIds += id+'-'+i+'-'+num+',';
  				}
  				//资产id拼接
  				var equipmentList = $("#selectedEquipmentBox .equipmentTr");
  				for(var i = 0;i < equipmentList.length;i++){
  					//id
  					var id = $(equipmentList[i]).attr("data-id");
  					eqIds += id +',';
  				}
  				//判断值的合法性
				if(eventName == ''){//事件名值为空
					layer.msg('事件名称不能为空',{icon: 5});
				}else if(eventType == '1' && eqIds == ''){
					layer.msg('事件类型为资产事件，但未绑定资产',{icon: 5});
				}else if(acIds == ''){//动作不能为空
					layer.msg('未添加任何动作',{icon: 5});
				}else if(eventDes == ''){//动作不能为空
					layer.msg('事件描述为空',{icon: 5});
				}else{
					var obj = {};
	  				obj.name = eventName;
	  				objevent_classify = eventType;
	  				obj.state = isUsedState;
	  				obj.enabled = isAlarmState;
	  				obj.message = eventDes;
	  				obj.userId = userId;
	  				obj.safeStrategyName = alarmName;
	  				obj.month = month;
	  				obj.day = day;
	  				obj.hour = hour;
	  				obj.minute = minute;
	  				obj.actionId = acIds;
	  				obj.equipmentIds = eqIds;
	  				if(getEventId != null){
	  					obj.id = getEventId;
	  					url = '../../event/updataById.do';
	  				}
	  				//成功函数
	  				var sFunc = function(data){
	  					if(data.success == "true"){//成功
							layer.msg(data.message,{icon: 1});
							//跳转到事件列表
							location.href="eventList.html"
							//关闭弹窗
							//layer.close(index);
						}else if(data.success == "false"){//失败
							layer.msg(data.message,{icon: 5});
						} 
	  				}
	  				ajaxPost(url,obj,sFunc);
				}
  				
  				
		  	})
		  	//返回按钮
		  	$(".goBack").click(function(){
		  		//跳转到事件列表
				location.href="eventList.html"
		  	})
		</script>
	</body>
</html>